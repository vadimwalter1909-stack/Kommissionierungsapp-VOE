{% extends "base.html" %}
{% block content %}

<h1>Dashboard – Gesamtfortschritt</h1>

{% set alles_fertig = (komplett_count == total and total > 0) %}

<!-- Export & Reset-Buttons -->
<div style="margin-bottom: 35px; display: flex; gap: 35px;">

    {% if alles_fertig %}
        <!-- AKTIVER Export-Button -->
        <form action="/export/komplett" method="get">
            <button type="submit" class="nav-button">
                Excel exportieren
            </button>
        </form>
    {% else %}
        <!-- DEAKTIVIERTER Export-Button -->
        <button class="nav-button" style="opacity: 0.4; cursor: not-allowed;" disabled>
            Excel exportieren
        </button>
    {% endif %}

    <!-- RESET-BUTTON (weiter weg, echte Button-Optik) -->
    <form action="/export/reset" method="get">
        <button type="submit"
                class="nav-button"
                style="background-color: #dc3545;"
                onclick="return confirm('Hast du die Excel-Datei erfolgreich gespeichert? Die App wird jetzt zurückgesetzt.');">
            App zurücksetzen
        </button>
    </form>

</div>

<div class="stats-box">
    <p>Gesamt: {{ total }} Kürzel</p>
    <p>Produktion fertig: {{ prod_fertig_count }}</p>
    <p>Logistik fertig: {{ log_fertig_count }}</p>
    <p><strong>Komplett fertig: {{ komplett_count }}</strong></p>

    <div class="progress-bar">
        <div class="progress-fill" style="width: {{ progress }}%;"></div>
    </div>
    <div class="progress-label">{{ progress }}%</div>
</div>

<h2>Komplett fertige Kürzel</h2>

{% if items|length == 0 %}
    <p>Es gibt aktuell keine vollständig abgeschlossenen Kürzel.</p>
{% else %}
    <div class="tile-container">
        {% for k in items %}
            <a href="/dashboard/{{ k }}" class="tile tile-fertig">
                <h2>{{ k }}</h2>
                <p>Produktion ✔</p>
                <p>Logistik ✔</p>
            </a>
        {% endfor %}
    </div>
{% endif %}

{% endblock %}
