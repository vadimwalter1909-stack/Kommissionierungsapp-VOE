{% extends "base.html" %}
{% block content %}

{% set page_title = "Dashboard ‚Äì Tages√ºbersicht" %}
{% set back_url = None %}

{# ---------------------------------------------------------
   Upload-Best√§tigung (Timestamp)
--------------------------------------------------------- #}
{% if request.query_params.get("upload_success") %}
    <div id="upload-success" class="upload-success">
        <span class="upload-icon">üëç</span>
        <span>Excel erfolgreich hochgeladen um {{ request.query_params.get("timestamp") }}</span>
    </div>
{% endif %}


{# ---------------------------------------------------------
   Excel Upload
--------------------------------------------------------- #}
<form action="/upload" method="post" enctype="multipart/form-data" class="upload-form">

    <div class="upload-row">
        <label for="file">Excel-Datei ausw√§hlen:</label>
        <input type="file" id="file" name="file" accept=".xlsx,.xls" required>
    </div>

    <button type="submit" class="bundle-button upload-btn">
        Hochladen
    </button>
</form>


{# ---------------------------------------------------------
   Tages√ºbersicht ‚Äì abgeschlossene K√ºrzel
--------------------------------------------------------- #}
<h2 class="section-title">Abgeschlossene K√ºrzel (Heute)</h2>

{% if entries|length == 0 %}
    <p>Heute wurden noch keine K√ºrzel abgeschlossen.</p>
{% else %}
    <div class="dashboard-mini-container">
        {% for e in entries %}
            <div class="dashboard-mini-tile">
                <div class="mini-left">

                    {# ‚≠ê PATCH: Start-BFT anzeigen #}
                    <strong class="mini-kuerzel">
                        {{ e.kuerzel }} ‚Äì Start: {{ e.start_bft }}
                    </strong>

                    <span class="mini-details">
                        {{ e.menge }} Stk ‚Ä¢ {{ e.zielort }} ‚Ä¢ {{ e.typ }}
                    </span>
                </div>

                <div class="mini-right">
                    <span class="mini-icon">‚úî</span>
                    <small class="mini-time">{{ e.timestamp.strftime("%H:%M") }}</small>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const box = document.getElementById("upload-success");
        if (box) {
            setTimeout(() => {
                box.style.opacity = "0";
                setTimeout(() => box.remove(), 1000);
            }, 3000);
        }
    });
</script>

{% endblock %}
